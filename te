public boolean actualizarImagen(Integer id, String fileName, InputStream fileContent) {
    try (Connection con = DriverManager.getConnection(
            SystemInfo.getInstance().getUserKey("URL"),
            SystemInfo.getInstance().getUserKey("USUARIO"),
            SystemInfo.getInstance().getUserKey("CLAVE"))) {

        // Verificar si existe una imagen con el id dado
        if (!existeImagen(id)) {
            return false; // No existe una imagen con el id dado, no se puede actualizar
        }

        // Actualizar la imagen
        PreparedStatement pstmt = con.prepareStatement(
                "UPDATE imagenes SET nombre = ?, imagen = ? WHERE id = ?");
        pstmt.setString(1, fileName);
        pstmt.setBlob(2, fileContent);
        pstmt.setInt(3, id);

        return pstmt.executeUpdate() > 0;

    } catch (SQLException e) {
        e.printStackTrace();
        System.out.println(e.toString());
        return false;
    }
}




@Override
protected void doPost(HttpServletRequest request, HttpServletResponse response)
        throws ServletException, IOException {
    try {
        // Cargar el driver
        Class.forName("com.mysql.cj.jdbc.Driver");
    } catch (ClassNotFoundException e) {
        e.printStackTrace();
        return;
    }
    
    try {
        String idStr = request.getParameter("personajeId");

        if (idStr != null) {
            Integer id = Integer.parseInt(idStr);
            Part filePart = request.getPart("file");
            String fileName = Paths.get(filePart.getSubmittedFileName()).getFileName().toString();
            InputStream fileContent = filePart.getInputStream();

            System.out.println("id: " + id + ", filePart: " + filePart.toString() + ", fileName: " + fileName);

            ImagenDAO imagenDAO = new ImagenDAO();
            
            // Verificar si existe una imagen con el id dado
            if (imagenDAO.existeImagen(id)) {
                // Existe una imagen, realiza la operaci贸n de actualizaci贸n
                if (imagenDAO.actualizarImagen(id, fileName, fileContent)) {
                    response.sendRedirect(request.getContextPath() + "/index.jsp");
                } else {
                    response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR, "An error occurred while updating the image.");
                }
            } else {
                // No existe una imagen con el id dado, realiza la operaci贸n de inserci贸n
                if (imagenDAO.guardarImagen(id, fileName, fileContent)) {
                    response.sendRedirect(request.getContextPath() + "/index.jsp");
                } else {
                    response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR, "An error occurred while saving the image.");
                }
            }
        } else {
            response.sendRedirect(request.getContextPath() + "/error500.jsp");
        }

    } catch (Exception e) {
        e.printStackTrace();
        response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR, "An error occurred while processing the file.");
    }
}
